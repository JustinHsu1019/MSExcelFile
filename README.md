# 美股六大科技股收益預測分析：基於L1正則化樣條回歸的量化投資研究

- 113-2 管理科學／作業研究：期末專案

## 專案概述

本研究針對美股六大科技巨頭（AAPL、AMZN、GOOGL、META、MSFT、NFLX）進行股票收益預測分析，運用管理科學的三大核心技術：**優化**、**模擬**與**預測**，建構一套完整的量化投資決策支援系統。

### 研究目標
- 建立基於L1正則化的樣條回歸模型，提升股票收益預測準確性
- 透過預算約束優化，找出最佳模型複雜度平衡點
- 構建預測區間，量化投資風險並支援決策制定
- 開發特徵重要性分析系統，增強模型解釋性

## 資料來源與期間

- **標的股票**：Apple (AAPL)、Amazon (AMZN)、Google (GOOGL)、Meta (META)、Microsoft (MSFT)、Netflix (NFLX)
- **資料期間**：2015年1月1日至2025年1月1日
- **資料來源**：Yahoo Finance API
- **預測變數**：前期收益率、交易量、波動率、RSI技術指標、移動平均線等7個核心特徵

## 方法論架構

### Part I：無約束樣條回歸 (5-Fold 交叉驗證)

**核心技術**：多變量樣條回歸 + L1最小絕對偏差優化

1. **特徵工程**：
   - 基礎特徵：`Return_lag1`、`Return_lag2`、`LogVolume_lag1`、`Volatility`、`RSI`、`MA5`、`MA20`
   - 樣條特徵：每個預測變數在10th、25th、50th、75th、90th百分位數建立節點（knots）
   - 轉折函數：$H_{i,j,q} = \max\{0, x_{i,j} - c_{j,q}\}$

2. **模型形式**：
   $$\hat{y}_i = \beta_0 + \sum_{j=1}^{p} \beta_j x_{i,j} + \sum_{j=1}^{p} \sum_{q} \gamma_{j,q} H_{i,j,q}$$

3. **優化目標**：
   $$\min_{\beta_0, \{\beta_j\}, \{\gamma_{j,q}\}} \sum_{i} | y_i - \hat{y}_i |$$

### Part II：L1預算約束優化

**核心技術**：約束線性規劃 + 網格搜尋

1. **預算約束**：
   $$\sum_{j=1}^p |\beta_j| + \sum_{j=1}^p \sum_q |\gamma_{j,q}| \leq B$$

2. **預算水準**：[0.5, 1, 2, 5, 10, 20, 50]

3. **最佳化準則**：
   $$B^* = \arg \min_{B} \text{CV-MAE}(B)$$

### Part III：預測區間建構

**核心技術**：Laplace分佈模擬 + 變異性建模

1. **殘差變異數建模**：
   - 對 $\ln(r_i^2)$ 進行樣條回歸估計 $\sigma^2(x)$
   - 設定Laplace尺度參數：$b_i = \sqrt{\hat{\sigma}_i^2}/\sqrt{2}$

2. **區間模擬**：
   - 抽樣100次誤差項：$e_i^{(s)} \sim \text{Laplace}(0, b_i)$
   - 計算90%預測區間：5th與95th百分位數

3. **評估指標**：
   - **覆蓋率**：實際值落在預測區間內的比例
   - **MSIS**：平均標準化區間分數（考慮區間寬度與懲罰項）

## 核心研究結果

### 整體表現總結

| 股票代碼 | 無約束CV-MAE | 最佳預算 | 約束後CV-MAE | 預測區間覆蓋率 | MSIS | 最重要特徵 |
|---------|-------------|---------|-------------|---------------|------|------------|
| AAPL    | 0.003000    | 20      | 0.003001    | 82.3%         | 23.37| MA5        |
| AMZN    | 0.003461    | 5       | 0.003460    | 87.4%         | 22.12| MA5        |
| GOOGL   | 0.002978    | 10      | 0.002977    | 87.2%         | 25.98| MA5        |
| META    | 0.003726    | 5       | 0.003727    | 87.0%         | 34.22| MA5        |
| MSFT    | 0.002796    | 10      | 0.002798    | 80.5%         | 21.04| MA5        |
| NFLX    | 0.004404    | 20      | 0.004408    | 89.0%         | 30.30| MA5        |

### 關鍵發現

1. **模型穩健性**：L1正則化約束並未顯著改變預測準確性，顯示基礎模型已具良好泛化能力

2. **預算選擇模式**：
   - 低波動股票（META、AMZN）偏好較低預算（B=5）
   - 高波動股票（AAPL、NFLX）需要較高預算（B=20）來保持模型複雜度

3. **技術指標重要性**：**MA5（5日移動平均）**在所有股票中均為最重要預測特徵，凸顯短期趨勢指標的預測價值

4. **預測區間品質**：
   - 平均覆蓋率：85.1%（接近目標90%）
   - NFLX表現最佳（89.0%），MSFT覆蓋率較低（80.5%）

5. **股票特異性**：
   - **最佳表現**：MSFT（MAE=0.002796）
   - **最具挑戰性**：NFLX（MAE=0.004404）

## 視覺化分析結果

![總結對比圖](https://github.com/RoyPeng126/MSExcelFile/blob/main/result/summary_comparison.png)

綜合分析圖表顯示：
- **左上圖**：無約束vs約束模型MAE比較，證實正則化的穩定效果
- **右上圖**：最佳預算分佈，揭示不同股票的最優複雜度需求
- **左下圖**：預測區間覆蓋率，評估風險量化品質
- **右下圖**：MSIS分數比較，衡量區間預測綜合表現

## Bonus 創新擴展

本研究在基礎三部分分析之上，實作了兩個具有實務價值的創新擴展：

### 1. 改進的變異性建模（類GARCH模型）
從基礎的同質變異數假設提升為異質變異數模型，透過將當期預測值的平方項和前期絕對殘差納入變異數方程：

```python
X_var = np.column_stack([
    np.ones(len(y_pred_train)),
    y_pred_train**2,  # 當期預測值平方項
    np.abs(residuals_lag1)  # 前期絕對殘差
])
```

此方法更準確地捕捉金融時間序列的**波動聚集特性**，使預測區間更貼近實際市場波動模式。

### 2. 特徵重要性分析系統
開發自動化特徵重要性識別與視覺化系統，包含：
- **重要性分數計算**：基於係數絕對值的跨fold平均
- **經濟意義解釋**：自動生成特徵的財務意涵說明
- **互動式圖表**：Top Features重要性排序與係數方向分析

此系統讓投資決策者能直觀理解模型預測邏輯，增強黑盒模型的透明度。

## 實務意涵與投資建議

### 對投資決策者的價值

1. **風險管理**：預測區間提供量化的不確定性評估，支援頭寸規模決策
2. **選股策略**：MSFT展現最佳預測穩定性，NFLX需要更謹慎的風險控制
3. **技術分析重點**：MA5作為關鍵預測因子，建議重點關注短期移動平均趨勢
4. **模型監控**：不同股票需要不同程度的模型複雜度，應定期重新校準預算參數

### 方法論貢獻

1. **理論創新**：結合樣條回歸與L1正則化，在靈活性與泛化能力間取得平衡
2. **技術實現**：運用Gurobi求解器處理大規模線性規劃問題，確保最優解品質
3. **實務導向**：完整的可視化框架與特徵解釋系統，提升模型在實務中的可操作性

## 數據與程式碼開放

- **完整結果數據**：[Project_Results.csv](https://github.com/RoyPeng126/MSExcelFile/blob/main/result/Project_Results.csv)
- **視覺化圖表**：[結果目錄](https://github.com/RoyPeng126/MSExcelFile/blob/main/result/)（包含各股票詳細分析圖表）
- **完整程式碼**：[main.py](https://github.com/RoyPeng126/MSExcelFile/blob/main/src/main.py)

## 結論

本研究成功整合優化、模擬與預測技術，建構了一套完整的股票收益預測系統。關鍵成就包括：

✓ **方法驗證**：L1正則化樣條回歸在股票預測中的有效性  
✓ **風險量化**：85%以上的預測區間覆蓋率，提供可靠的不確定性評估  
✓ **決策支援**：特徵重要性分析與視覺化工具，增強模型解釋性  
✓ **實務應用**：針對不同股票特性的差異化建模策略  


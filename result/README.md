# 📈 管理科學期末專案

## 📘 專案主題：FAANG 股票的樣條回歸預測與風險區間分析

本專案以 FAANG 股票為案例，實作三大分析核心：**最佳化模型建構、模擬預測、預測區間評估**。我們透過線性規劃解決樣條回歸模型，並利用殘差變異估計與拉普拉斯分布模擬未來不確定性，最終形成可供決策的風險預測區間。

---

## 📦 資料來源與處理

- **資料來源**：Yahoo Finance（透過 `yfinance` 套件）
- **股票標的**：AAPL、AMZN、GOOGL、META、MSFT、NFLX
- **期間範圍**：2015-01-01 至 2025-01-01
- **目標變數**：每日對數報酬率（LogReturn）
- **特徵變數**：
  - 落後報酬率：`Return_lag1`, `Return_lag2`
  - 成交量變化：`LogVolume_lag1`
  - 滾動波動度（5日）：`Volatility`
  - 技術指標 RSI（14日）：`RSI`
  - 均線偏離率：`MA5`, `MA20`

---

## 🔧 Part I：無約束樣條回歸模型

透過在每個預測變數上建立 **5 個斷點（10%、25%、50%、75%、90% 百分位數）**，我們對每個特徵加入 Hinge 特徵，並透過線性規劃最小化 5 折交叉驗證下的 **平均絕對誤差（CV-MAE）**。

### 📈 模型目標式：
$$
\min_{\beta} \sum_i |y_i - \hat{y}_i|
$$

### ✅ Part I 結果：無約束樣條模型之 CV-MAE
| 股票代碼 | CV-MAE（無約束模型） |
|----------|-----------------------|
| AAPL     | 0.00300               |
| AMZN     | 0.00346               |
| GOOGL    | 0.00298               |
| META     | 0.00373               |

---

## 💡 Part II：L1 預算限制下的模型選擇

為提升模型的解釋力與避免過度擬合，我們在迴歸係數上加入 L1 正則化限制，針對不同的預算水準（0.5 ~ 50）進行網格搜尋，選出交叉驗證表現最佳的預算值。

### 📏 預算約束條件：
$$
\sum_j |\beta_j| + \sum_{j,q} |\gamma_{j,q}| \leq B
$$

### 🎯 最佳預算選擇：
- 最佳預算多集中於 **5 ~ 20**
- 顯著變數常出現 `Return_lag1`, `RSI`, 以及部分斷點特徵（Hinge Terms）

---

## 🔮 Part III：預測區間建構與評估

我們以訓練集殘差平方為基礎，進行變異建模（使用類 GARCH 結構），再以拉普拉斯分布模擬未來誤差，構建每筆觀測的 90% 預測區間，並計算下列兩個指標：

- **Coverage**：實際觀測值落在區間內的比例（希望接近 90%）
- **MSIS**：預測區間的平均寬度與失準懲罰（越低越好）

---

## 📊 各股票分析總結

| 股票代碼 | 無約束 CV-MAE | 最佳預算 | 預算後 CV-MAE | 區間 Coverage | 平均 MSIS |
|----------|----------------|----------|----------------|----------------|------------|
| AAPL     | 0.00300        | 10       | 0.00300        | 0.8206         | 23.35      |
| AMZN     | 0.00346        | 5        | 0.00346        | 0.8706         | 22.66      |
| GOOGL    | 0.00298        | 5        | 0.00298        | 0.8819         | 25.88      |
| META     | 0.00373        | 10       | 0.00373        | 0.8782         | 34.51      |
| MSFT     | 0.00280        | 5        | 0.00280        | 0.8113         | 20.83      |
| NFLX     | 0.00440        | 20       | 0.00441        | 0.8879         | 30.25      |

---

## 🧠 延伸創意（可選 Bonus）

本專案於 Part III 中嘗試應用類 GARCH 結構建模殘差變異性，相較於原始課程建議的線性變異模型，能更符合財務報酬序列的異方差性特徵，有助於建構更可靠的預測區間。
